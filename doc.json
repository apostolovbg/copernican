{
  "projectName": "Copernican Suite",
  "projectVersion": "1.3",
  "lastUpdated": "2025-06-11",
  "description": "This document serves as the master technical specification and AI development interface for the Copernican Suite. It defines the required structure for all components, outlines the development protocol, and provides a 'how-to' guide for creating new cosmological model plugins. This version includes AI-hardening features to ensure strict adherence to the plugin interface.",
  "projectSchema": {
    "copernican.py": "Main orchestrator script. Handles user interaction, workflow control, and calls to other modules. All output generation calls originate here.",
    "cosmo_engine.py": "The core physics and statistics engine. Handles parameter fitting (via SciPy's minimize) and chi-squared calculations. It calls functions from model plugins but is model-agnostic.",
    "output_manager.py": "Manages all outputs: logging, plots, and detailed CSV data files. Contains functions for generating standardized plots and data tables.",
    "data_loaders.py": "Modular data loading system. Contains parsers for different SNe Ia and BAO data formats. New data formats can be supported by adding new parsers here.",
    "lcdm_model.py": "The reference implementation of the standard LambdaCDM model. Serves as the primary 'control' model and a template for plugins requiring numerical integration.",
    "usmf3b.py": "An example of a fully analytic cosmological model. Serves as a template for plugins with computationally simple, closed-form solutions.",
    "README.md": "The main user-facing documentation, providing a high-level overview, history, and future vision.",
    "doc.json": "This file. The authoritative technical specification for AI and developer reference.",
    "output/": "The dedicated directory where all generated plots, logs, and CSV files are saved."
  },
  "modelPluginInterface": {
    "description": "To create a new cosmological model, two files are required: a Markdown definition (.md) and a Python implementation (.py). They must strictly adhere to the following interface to be compatible with cosmo_engine.py.",
    "markdownDefinitionFile": {
      "fileExtension": ".md",
      "purpose": "The human-readable 'paper' and machine-parsable single source of truth for model parameters and equations.",
      "requirements": [
        {
          "element": "YAML Front Matter",
          "details": "The file MUST begin with a YAML block (---...---) containing the keys: 'title', 'version', 'date', and 'model_plugin' (the name of the corresponding .py file)."
        },
        {
          "element": "Quantitative Model Specification Section",
          "details": "The file MUST contain a level-2 markdown header: '## Quantitative Model Specification for Copernican Suite'. This section is critical for automated parsing."
        },
        {
          "element": "Key Equations Subsections",
          "details": "Within the quantitative section, there MUST be level-3 headers '### Key Equations' with separate entries for 'Supernovae (SNe Ia) Fitting' and 'Baryon Acoustic Oscillation (BAO) Analysis', containing the model's core equations in LaTeX."
        },
        {
          "element": "Model Parameters Table",
          "details": "Within the quantitative section, there MUST be a level-3 header '### Model Parameters' followed by a Markdown table. This table MUST have the exact following headers: 'Parameter Name', 'Python Variable', 'Initial Guess', 'Bounds', 'Unit', 'LaTeX Name'."
        }
      ]
    },
    "pythonImplementationFile": {
      "fileExtension": ".py",
      "purpose": "The computational implementation of the model. It provides the functions that cosmo_engine.py will call to perform calculations.",
      "requirements": {
        "metadataBlock": {
          "description": "The file MUST define a set of global variables. Their names are NOT flexible. They must match the strictName exactly.",
          "pythonExample": "MODEL_NAME = \"YourModelName\"\nMODEL_DESCRIPTION = \"A description.\"\nMODEL_EQUATIONS_LATEX_SN = [r\"...\", r\"...\"]\nMODEL_EQUATIONS_LATEX_BAO = [r\"...\", r\"...\"]\nPARAMETER_NAMES = [\"p1\", \"p2\"]\nPARAMETER_LATEX_NAMES = [r\"$p_1$\", r\"$p_2$\"]\nPARAMETER_UNITS = [\"unit1\", \"\"]\nINITIAL_GUESSES = [1.0, 2.0]\nPARAMETER_BOUNDS = [(0.1, 2.0), (1.0, 3.0)]\nFIXED_PARAMS = {\"C_LIGHT_KM_S\": 299792.458}",
          "variables": [
            {"strictName": "MODEL_NAME"},
            {"strictName": "MODEL_DESCRIPTION"},
            {"strictName": "MODEL_EQUATIONS_LATEX_SN"},
            {"strictName": "MODEL_EQUATIONS_LATEX_BAO"},
            {"strictName": "PARAMETER_NAMES"},
            {"strictName": "PARAMETER_LATEX_NAMES"},
            {"strictName": "PARAMETER_UNITS"},
            {"strictName": "INITIAL_GUESSES"},
            {"strictName": "PARAMETER_BOUNDS"},
            {"strictName": "FIXED_PARAMS"}
          ]
        },
        "mandatoryFunctions": {
          "description": "The file MUST implement the following functions. Their names and signatures are NOT flexible.",
          "pythonExample": "def distance_modulus_model(z_array, *cosmo_params):\n    # ... your implementation ...\n    return mu_array\n\ndef get_Hz_per_Mpc(z_array, *cosmo_params):\n    # ... your implementation ...\n    return hz_array",
          "functions": [
            {"strictName": "distance_modulus_model(z_array, *cosmo_params)"},
            {"strictName": "get_comoving_distance_Mpc(z_array, *cosmo_params)"},
            {"strictName": "get_luminosity_distance_Mpc(z_array, *cosmo_params)"},
            {"strictName": "get_angular_diameter_distance_Mpc(z_array, *cosmo_params)"},
            {"strictName": "get_Hz_per_Mpc(z_array, *cosmo_params)"},
            {"strictName": "get_DV_Mpc(z_array, *cosmo_params)"},
            {"strictName": "get_sound_horizon_rs_Mpc(*cosmo_params)"}
          ]
        }
      }
    }
  },
  "developmentProtocol": {
    "aiDevelopmentGuidelines": {
      "description": "To ensure clarity, maintainability, and smooth transitions between development sessions, a strict commenting and documentation standard MUST be followed by any modifying AI.",
      "rules": [
        "Add a 'DEV NOTE' at the top of any modified file summarizing changes for the current version and providing guidance for future modifications.",
        "Comment code extensively. Explain the purpose of new functions, the logic behind complex algorithms or bug fixes, and the flow of data.",
        "Update the main README.md and this doc.json file to reflect the latest changes, architectural decisions, and future plans."
      ]
    },
    "creatingNewModelWorkflow": {
      "description": "The workflow for an AI to generate a new, compatible cosmological model plugin from a user's idea.",
      "steps": [
        "Step 1: Ingest User Idea & Templates. Receive the user's conceptual model idea, this doc.json file, lcdm_model.py (numerical template), and usmf3b.py (analytic template).",
        "Step 2: Formulate Equations. Translate the user's idea into a set of mathematical equations. Prioritize creating analytic, closed-form solutions for distance measures to ensure high computational performance. If numerical integration is unavoidable, follow the pattern in lcdm_model.py.",
        "Step 3: Create the Markdown (.md) Definition File. Following the `modelPluginInterface.markdownDefinitionFile` specification, write the complete .md file. This file is the 'source of truth'.",
        "Step 4: Create the Python (.py) Implementation File. Following the `modelPluginInterface.pythonImplementationFile` specification, write the Python code. Implement all mandatory functions and metadata variables using the exact names specified.",
        "Step 5: Verify & Deliver. Before delivering the files, perform a final check against the `verificationChecklist` below. Deliver the two new files (`new_model.md` and `new_model.py`) to the user for testing."
      ],
      "verificationChecklist": [
          "Does the .py file contain the global variable 'MODEL_NAME'?",
          "Does the .py file contain the global variable 'PARAMETER_NAMES'?",
          "Does the .py file contain the global variable 'INITIAL_GUESSES'?",
          "Does the .py file contain the global variable 'PARAMETER_BOUNDS'?",
          "Does the .py file contain the function 'distance_modulus_model(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_comoving_distance_Mpc(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_luminosity_distance_Mpc(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_angular_diameter_distance_Mpc(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_Hz_per_Mpc(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_DV_Mpc(z_array, *cosmo_params)'?",
          "Does the .py file contain the function 'get_sound_horizon_rs_Mpc(*cosmo_params)'?"
      ]
    }
  }
}
